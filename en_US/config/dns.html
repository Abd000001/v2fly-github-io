<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DNS Server | V2Fly.org</title>
    <meta name="generator" content="VuePress 1.8.3">
    <link rel="apple-touch-icon" size="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" size="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" size="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" color="#5bbad5" href="/safari-pinned-tab.svg">
    <meta name="description" content="Project V is a collection of tools that can help you build your own basic communication network">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="apple-mobile-web-app-title" content="Project V">
    <meta name="application-name" content="Project V">
    <meta name="msapplication-TileColor" content="#da532c">
    
    <link rel="preload" href="/assets/css/0.styles.d72e43c9.css" as="style"><link rel="preload" href="/assets/js/app.295be218.js" as="script"><link rel="preload" href="/assets/js/3.b9b95611.js" as="script"><link rel="preload" href="/assets/js/6.57727bb8.js" as="script"><link rel="preload" href="/assets/js/55.3b9abfc4.js" as="script"><link rel="prefetch" href="/assets/js/10.9f4e224c.js"><link rel="prefetch" href="/assets/js/100.0cc3de60.js"><link rel="prefetch" href="/assets/js/101.ce062de2.js"><link rel="prefetch" href="/assets/js/102.974df5a2.js"><link rel="prefetch" href="/assets/js/103.53fec0a2.js"><link rel="prefetch" href="/assets/js/104.fe954e90.js"><link rel="prefetch" href="/assets/js/105.99777d40.js"><link rel="prefetch" href="/assets/js/106.df21d6a2.js"><link rel="prefetch" href="/assets/js/107.9b182dd0.js"><link rel="prefetch" href="/assets/js/108.86084416.js"><link rel="prefetch" href="/assets/js/109.770f8866.js"><link rel="prefetch" href="/assets/js/11.d9cdaf67.js"><link rel="prefetch" href="/assets/js/110.0d51ce92.js"><link rel="prefetch" href="/assets/js/111.9c148110.js"><link rel="prefetch" href="/assets/js/112.5697a808.js"><link rel="prefetch" href="/assets/js/113.7a13c5f3.js"><link rel="prefetch" href="/assets/js/114.0bbcc42c.js"><link rel="prefetch" href="/assets/js/115.08f6ea40.js"><link rel="prefetch" href="/assets/js/116.0cf63703.js"><link rel="prefetch" href="/assets/js/117.525b24cd.js"><link rel="prefetch" href="/assets/js/118.91723174.js"><link rel="prefetch" href="/assets/js/119.c170065b.js"><link rel="prefetch" href="/assets/js/12.103eee59.js"><link rel="prefetch" href="/assets/js/120.6ad99814.js"><link rel="prefetch" href="/assets/js/121.4d0a36fa.js"><link rel="prefetch" href="/assets/js/122.83866dad.js"><link rel="prefetch" href="/assets/js/123.ee093ebc.js"><link rel="prefetch" href="/assets/js/124.c075071a.js"><link rel="prefetch" href="/assets/js/125.56018fb1.js"><link rel="prefetch" href="/assets/js/126.df95be2f.js"><link rel="prefetch" href="/assets/js/127.0180b47e.js"><link rel="prefetch" href="/assets/js/128.32b9dde3.js"><link rel="prefetch" href="/assets/js/129.7fb0b5e4.js"><link rel="prefetch" href="/assets/js/13.b26f85d7.js"><link rel="prefetch" href="/assets/js/130.a8bae491.js"><link rel="prefetch" href="/assets/js/131.326a8dd3.js"><link rel="prefetch" href="/assets/js/14.e38c66da.js"><link rel="prefetch" href="/assets/js/15.e2fc2eb1.js"><link rel="prefetch" href="/assets/js/16.b9db337b.js"><link rel="prefetch" href="/assets/js/17.a68292a6.js"><link rel="prefetch" href="/assets/js/18.deda6db2.js"><link rel="prefetch" href="/assets/js/19.299961aa.js"><link rel="prefetch" href="/assets/js/20.a3b139e6.js"><link rel="prefetch" href="/assets/js/21.07e4b5b8.js"><link rel="prefetch" href="/assets/js/22.7904155c.js"><link rel="prefetch" href="/assets/js/23.b03259ee.js"><link rel="prefetch" href="/assets/js/24.4fdc7742.js"><link rel="prefetch" href="/assets/js/25.f4745d8f.js"><link rel="prefetch" href="/assets/js/26.b5364e1f.js"><link rel="prefetch" href="/assets/js/27.16834cf4.js"><link rel="prefetch" href="/assets/js/28.62842a12.js"><link rel="prefetch" href="/assets/js/29.4d7b9325.js"><link rel="prefetch" href="/assets/js/30.1f81f638.js"><link rel="prefetch" href="/assets/js/31.2c798b43.js"><link rel="prefetch" href="/assets/js/32.7060bdb8.js"><link rel="prefetch" href="/assets/js/33.8ca30a64.js"><link rel="prefetch" href="/assets/js/34.82b8bf7f.js"><link rel="prefetch" href="/assets/js/35.5fdcd59d.js"><link rel="prefetch" href="/assets/js/36.b3fdf2d1.js"><link rel="prefetch" href="/assets/js/37.64920e17.js"><link rel="prefetch" href="/assets/js/38.cb898485.js"><link rel="prefetch" href="/assets/js/39.cb724cc5.js"><link rel="prefetch" href="/assets/js/4.d3365c46.js"><link rel="prefetch" href="/assets/js/40.aed2e4cd.js"><link rel="prefetch" href="/assets/js/41.4d253343.js"><link rel="prefetch" href="/assets/js/42.023c0c5a.js"><link rel="prefetch" href="/assets/js/43.d30d097a.js"><link rel="prefetch" href="/assets/js/44.2ed32b63.js"><link rel="prefetch" href="/assets/js/45.e407a460.js"><link rel="prefetch" href="/assets/js/46.a0851fc0.js"><link rel="prefetch" href="/assets/js/47.4c1a7d7a.js"><link rel="prefetch" href="/assets/js/48.47f7a2ad.js"><link rel="prefetch" href="/assets/js/49.06cef46f.js"><link rel="prefetch" href="/assets/js/5.76321845.js"><link rel="prefetch" href="/assets/js/50.b970489e.js"><link rel="prefetch" href="/assets/js/51.53cf538c.js"><link rel="prefetch" href="/assets/js/52.8aaf4da7.js"><link rel="prefetch" href="/assets/js/53.4182a49c.js"><link rel="prefetch" href="/assets/js/54.d86be373.js"><link rel="prefetch" href="/assets/js/56.cb48777a.js"><link rel="prefetch" href="/assets/js/57.77ba722c.js"><link rel="prefetch" href="/assets/js/58.30833271.js"><link rel="prefetch" href="/assets/js/59.db517cdc.js"><link rel="prefetch" href="/assets/js/60.741224c8.js"><link rel="prefetch" href="/assets/js/61.be571606.js"><link rel="prefetch" href="/assets/js/62.bdd7b6f4.js"><link rel="prefetch" href="/assets/js/63.4abe922c.js"><link rel="prefetch" href="/assets/js/64.914dc97d.js"><link rel="prefetch" href="/assets/js/65.5c182fe5.js"><link rel="prefetch" href="/assets/js/66.529c2619.js"><link rel="prefetch" href="/assets/js/67.0b2c6852.js"><link rel="prefetch" href="/assets/js/68.d98b37a8.js"><link rel="prefetch" href="/assets/js/69.9bfb6d4b.js"><link rel="prefetch" href="/assets/js/7.a1ceef40.js"><link rel="prefetch" href="/assets/js/70.08a70195.js"><link rel="prefetch" href="/assets/js/71.c6694c25.js"><link rel="prefetch" href="/assets/js/72.68145776.js"><link rel="prefetch" href="/assets/js/73.b58b4338.js"><link rel="prefetch" href="/assets/js/74.5a595cc6.js"><link rel="prefetch" href="/assets/js/75.60c6732a.js"><link rel="prefetch" href="/assets/js/76.9edae4f0.js"><link rel="prefetch" href="/assets/js/77.5b5c499c.js"><link rel="prefetch" href="/assets/js/78.47a057b7.js"><link rel="prefetch" href="/assets/js/79.83bd83c0.js"><link rel="prefetch" href="/assets/js/8.a3f619fb.js"><link rel="prefetch" href="/assets/js/80.c9b0e797.js"><link rel="prefetch" href="/assets/js/81.8aec7ef2.js"><link rel="prefetch" href="/assets/js/82.f8e6af78.js"><link rel="prefetch" href="/assets/js/83.6397ed37.js"><link rel="prefetch" href="/assets/js/84.e8bdb28e.js"><link rel="prefetch" href="/assets/js/85.11813a7c.js"><link rel="prefetch" href="/assets/js/86.436d7e09.js"><link rel="prefetch" href="/assets/js/87.1c76fba7.js"><link rel="prefetch" href="/assets/js/88.98708470.js"><link rel="prefetch" href="/assets/js/89.826e9d2f.js"><link rel="prefetch" href="/assets/js/9.baf94d45.js"><link rel="prefetch" href="/assets/js/90.ea7509b6.js"><link rel="prefetch" href="/assets/js/91.a139b132.js"><link rel="prefetch" href="/assets/js/92.ff38af99.js"><link rel="prefetch" href="/assets/js/93.7ed060c2.js"><link rel="prefetch" href="/assets/js/94.b0a99741.js"><link rel="prefetch" href="/assets/js/95.64208f40.js"><link rel="prefetch" href="/assets/js/96.66bb7674.js"><link rel="prefetch" href="/assets/js/97.58c7dae5.js"><link rel="prefetch" href="/assets/js/98.11b2c27b.js"><link rel="prefetch" href="/assets/js/99.12ba8c1b.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.999f295f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d72e43c9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en_US/" class="home-link router-link-active"><img src="/v2ray.png" alt="V2Fly.org" class="logo"> <span class="site-name can-hide">V2Fly.org</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/en_US/guide/start.html" class="nav-link">
  Quick Start
</a></div><div class="nav-item"><a href="/en_US/config/overview.html" class="nav-link">
  Config Reference
</a></div><div class="nav-item"><a href="/en_US/awesome/tools.html" class="nav-link">
  Tools
</a></div><div class="nav-item"><a href="/en_US/developer/intro/compile.html" class="nav-link">
  Developer Guide
</a></div><div class="nav-item"><a href="https://guide.v2fly.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  New concise guide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="选择语言" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="选择语言" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/config/dns.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en_US/config/dns.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <a href="https://github.com/v2fly" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/en_US/guide/start.html" class="nav-link">
  Quick Start
</a></div><div class="nav-item"><a href="/en_US/config/overview.html" class="nav-link">
  Config Reference
</a></div><div class="nav-item"><a href="/en_US/awesome/tools.html" class="nav-link">
  Tools
</a></div><div class="nav-item"><a href="/en_US/developer/intro/compile.html" class="nav-link">
  Developer Guide
</a></div><div class="nav-item"><a href="https://guide.v2fly.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  New concise guide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="选择语言" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="选择语言" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/config/dns.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en_US/config/dns.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <a href="https://github.com/v2fly" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Config Reference</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en_US/config/overview.html" class="sidebar-link">Configuration File Format</a></li><li><a href="/en_US/config/dns.html" aria-current="page" class="active sidebar-link">DNS Server</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en_US/config/dns.html#dns-processing-flow" class="sidebar-link">DNS processing flow</a></li><li class="sidebar-sub-header"><a href="/en_US/config/dns.html#dnsobject" class="sidebar-link">DnsObject</a></li><li class="sidebar-sub-header"><a href="/en_US/config/dns.html#serverobject" class="sidebar-link">ServerObject</a></li></ul></li><li><a href="/en_US/config/outbounds.html" class="sidebar-link">Outbounds</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Protocols</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en_US/config/protocols/blackhole.html" class="sidebar-link">Blackhole</a></li><li><a href="/en_US/config/protocols/dns.html" class="sidebar-link">DNS</a></li><li><a href="/en_US/config/protocols/dokodemo.html" class="sidebar-link">Dokodemo-door</a></li><li><a href="/en_US/config/protocols/freedom.html" class="sidebar-link">Freedom</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Transport</span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="dns-server"><a href="#dns-server" class="header-anchor">#</a> DNS Server</h1> <p>V2Ray has a built-in DNS server, which has two main purposes: matching routing rules according to the IP resolved from a domain, and traditional DNS function—resolving the target address to connect.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Due to the complexity of DNS protocol, V2Ray only supports basic IP query function (A and AAAA records). In order to have a complete DNS experience, you may want to use an dedicated DNS serverware, such as <a href="https://coredns.io" target="_blank" rel="noopener noreferrer">CoreDNS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, together with V2Ray's builtin DNS features.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>For <code>outbound</code>s with <code>freedom</code> protocol, the default value of <code>domainStrategy</code> is <code>AsIs</code>, therefore the DNS settings will not be applied to this outbound by default. If necessary, it should be configured as<code>UseIP</code>.</p></div> <h2 id="dns-processing-flow"><a href="#dns-processing-flow" class="header-anchor">#</a> DNS processing flow</h2> <p>When a domain name list assigned by a DNS server matches the domain name currently being queried, V2Ray will use this DNS server first, otherwise, it will query from top to bottom, and only return the IP list which matches expectIPs. The processing flow diagram of the DNS server is as follows:</p> <p><img src="/dns_flowchart_en.png" alt=""></p> <h2 id="dnsobject"><a href="#dnsobject" class="header-anchor">#</a> DnsObject</h2> <p><code>DnsObject</code> corresponds to the <code>dns</code> field of the configuration file.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;hosts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;baidu.com&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;servers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.2.3.4&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">5353</span><span class="token punctuation">,</span>
            <span class="token property">&quot;domains&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;domain:v2ray.com&quot;</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;expectIPs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;geoip:cn&quot;</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;8.8.8.8&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;8.8.4.4&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;localhost&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;clientIp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.2.3.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dns_inbound&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>hosts</code>: map{string: address}</p></blockquote> <p>Static IP list, its value is a series of &quot;domain name&quot;: &quot;address&quot;. The address can be an IP or domain name. When resolving a domain name, if the domain name matches an item in this list when the address of the item is an IP, the resolution result is the IP of the item, and the following servers are not used for resolution; when the address is a domain name, this domain name will be used for IP resolution instead of the original domain name.</p> <p>The domain name format has the following forms:</p> <ul><li>Pure string: When this domain name completely matches the target domain name, the rule takes effect. For example, &quot;v2ray.com&quot; matches &quot;v2ray.com&quot; but not &quot;www.v2ray.com&quot;.</li> <li>Regular expression: Start with <code>&quot;regexp:&quot;</code>, and the rest is a regular expression. When this regular expression matches the target domain name, the rule takes effect. For example, &quot;regexp:\\.goo.*\\.com$&quot; matches &quot;www.google.com&quot; and &quot;fonts.googleapis.com&quot; but not &quot;google.com&quot;.</li> <li>Subdomain (recommended): Start with <code>&quot;domain:&quot;</code>, and the rest part is a domain name. This rule takes effect when the domain name is the target domain name or its subdomain name. For example, &quot;domain:v2ray.com&quot; matches &quot;www.v2ray.com&quot;, &quot;v2ray.com&quot;, but not &quot;xv2ray.com&quot;.</li> <li>Substring: Start with <code>&quot;keyword:&quot;</code>, and the rest part is a string. When this string matches any part of the target domain name, the rule takes effect. For example, &quot;keyword:sina.com&quot; can match &quot;sina.com&quot;, &quot;sina.com.cn&quot; and &quot;www.sina.com&quot; but not &quot;sina.cn&quot;.</li> <li>List of predefined domain names: Start with <code>&quot;geosite:&quot;</code>, and the rest is a name, such as <code>geosite:google</code> or <code>geosite:cn</code>. For the name and domain name list, please refer to <a href="/en_US/config/routing.html#dlc">Predefined Domain Name List</a>.</li></ul> <blockquote><p><code>servers</code>: [string | <a href="#serverobject">ServerObject</a> ]</p></blockquote> <p>A list of DNS servers, supporting two types: DNS address (string format) and <a href="#serverobject">ServerObject</a>. When its value is a DNS IP address, such as <code>&quot;8.8.8.8&quot;</code>, V2Ray will use port 53 of this address for DNS query.</p> <p>When the value is <code>&quot;localhost&quot;</code>, it means the machine's preset DNS configuration is used. When the value is in the form of <code>&quot;https://host:port/dns-query&quot;</code>, such as <code>&quot;https://dns.google/dns-query&quot;</code>, V2Ray will use <code>DNS over HTTPS</code> (RFC8484, short for DOH) to query. Some service providers have certificates of IP aliases, then you can write IP format directly, such as <code>https://1.1.1.1/dns-query</code>. You can also use non-standard ports and paths, such as <code>&quot;https://a.b.c.d:8443/my-dns-query&quot;</code> (4.22.0+).</p> <p>When the value is in the form of <code>&quot;https+local://host:port/dns-query&quot;</code>, such as <code>&quot;https+local://dns.google/dns-query&quot;</code>, V2Ray will use <code>DOH local mode</code> for queries, that is, DOH requests will not go through Routing/Outbound and other components, but directly request externally to improve timing. Generally suitable for use on the server side. Non-standard ports and paths can also be used. (4.22.0+)</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>When using <code>localhost</code>, the DNS request of this machine is not controlled by V2Ray, and additional configuration is needed to make DNS request forwarded by V2Ray.</p> <p>The DNS clients initialized by different rules will be reflected in the V2Ray startup log with an <code>info</code> level, such as <code>local DOH</code>, <code>remote DOH</code> and <code>udp</code> and other modes. (4.22.0+)</p></div> <blockquote><p><code>clientIp</code>: string</p></blockquote> <p>The IP address of the current system. It is used to inform server the client's location during DNS queries. It cannot be a private address.</p> <blockquote><p><code>tag</code>: string</p></blockquote> <p>(V2Ray 4.13+) The query traffic sent by this DNS, except <code>localhost</code> and <code>DOHL_</code> modes, will carry this identifier, which can be matched with <code>inboundTag</code> in the routing.</p> <h2 id="serverobject"><a href="#serverobject" class="header-anchor">#</a> ServerObject</h2> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.2.3.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">5353</span><span class="token punctuation">,</span>
    <span class="token property">&quot;domains&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;domain:v2ray.com&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;expectIPs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;geoip:cn&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>address</code>: address</p></blockquote> <p>DNS server address, such as <code>&quot;8.8.8.8&quot;</code>. For ordinary DNS IP addresses that only support the UDP protocol DNS server, if the address is in the form of a URL beginning with <code>&quot;https://&quot;</code> or <code>&quot;https+local://&quot;</code>, DOH mode is used, and the rules are the same as DOH configuration in string mode.</p> <blockquote><p><code>port</code>: number</p></blockquote> <p>DNS server port, such as <code>53</code>. This item defaults to <code>53</code> by default. When using DOH mode, this item is invalid, non-standard port should be specified in URL.</p> <blockquote><p><code>domains</code>: [string]</p></blockquote> <p>A list of domain names. The domain names contained in this list will be queried by this server first. The domain name format is the same as it in <a href="/en_US/config/routing.html#ruleobject">Routing Configuration</a>.</p> <blockquote><p><code>expectIPs</code>:[string]</p></blockquote> <p>(V2Ray 4.22.0+) A list of IP ranges, the format is the same as it in <a href="/en_US/config/routing.html#ruleobject">route configuration</a>.</p> <p>When this option is configured, V2Ray DNS will verify the returned IP and only return addresses in the expectIPs list.</p> <p>If this item is not configured, the IP address will be returned as it is.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/v2fly/v2fly-github-io/edit/master/docs/en_US/config/dns.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/13/2020, 6:42:40 AM</span></div></footer> <div class="contributors" style="display:none;" data-v-6000aab7><span data-v-6000aab7>Contributors</span> </div> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en_US/config/overview.html" class="prev">
        Configuration File Format
      </a></span> <span class="next"><a href="/en_US/config/outbounds.html">
        Outbounds
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.295be218.js" defer></script><script src="/assets/js/3.b9b95611.js" defer></script><script src="/assets/js/6.57727bb8.js" defer></script><script src="/assets/js/55.3b9abfc4.js" defer></script>
  </body>
</html>
