(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{436:function(v,_,t){"use strict";t.r(_);var a=t(11),r=Object(a.a)({},(function(){var v=this,_=v.$createElement,t=v._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("h1",{attrs:{id:"mkcp-协议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mkcp-协议"}},[v._v("#")]),v._v(" mKCP 协议")]),v._v(" "),t("p",[v._v("mKCP 是流式传输协议，由 "),t("a",{attrs:{href:"https://github.com/skywind3000/kcp",target:"_blank",rel:"noopener noreferrer"}},[v._v("KCP 协议"),t("OutboundLink")],1),v._v("修改而来，可以按顺序传输任意的数据流。")]),v._v(" "),t("h2",{attrs:{id:"版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#版本"}},[v._v("#")]),v._v(" 版本")]),v._v(" "),t("p",[v._v("mKCP 没有版本号，不保证版本之间兼容性。")]),v._v(" "),t("h2",{attrs:{id:"依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#依赖"}},[v._v("#")]),v._v(" 依赖")]),v._v(" "),t("h3",{attrs:{id:"底层协议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#底层协议"}},[v._v("#")]),v._v(" 底层协议")]),v._v(" "),t("p",[v._v("mKCP 是一个基于 UDP 的协议，所有通讯使用 UDP 传输。")]),v._v(" "),t("h3",{attrs:{id:"函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#函数"}},[v._v("#")]),v._v(" 函数")]),v._v(" "),t("ul",[t("li",[v._v("fnv: "),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/Fowler%E2%80%93Noll%E2%80%93Vo_hash_function",target:"_blank",rel:"noopener noreferrer"}},[v._v("FNV-1a"),t("OutboundLink")],1),v._v(" 哈希函数\n"),t("ul",[t("li",[v._v("输入参数为任意长度的字符串；")]),v._v(" "),t("li",[v._v("输入出一个 32 位无符号整数；")])])])]),v._v(" "),t("h2",{attrs:{id:"通讯过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通讯过程"}},[v._v("#")]),v._v(" 通讯过程")]),v._v(" "),t("ol",[t("li",[v._v("mKCP 将数据流拆成若干个数据包进行发送。一个数据流有一个唯一标识，用以区分不同的数据流。数据流中的每一个数据包都携带了同样的标识。")]),v._v(" "),t("li",[v._v("mKCP 没有握手过程，当收到一个数据包时，根据其携带的数据流的标识来判断是否为新的通话，或是正在进行中的通话。")]),v._v(" "),t("li",[v._v("每一个数据包中包含若干个片段（Segment），片段分为三类：数据（Data）、确认（ACK）、心跳（Ping）。每个片段需要单独处理。")])]),v._v(" "),t("h2",{attrs:{id:"数据格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据格式"}},[v._v("#")]),v._v(" 数据格式")]),v._v(" "),t("h3",{attrs:{id:"数据包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据包"}},[v._v("#")]),v._v(" 数据包")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("4 字节")]),v._v(" "),t("th",[v._v("2 字节")]),v._v(" "),t("th",[v._v("L 字节")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("认证信息 A")]),v._v(" "),t("td",[v._v("数据长度 L")]),v._v(" "),t("td",[v._v("片段部分")])])])]),v._v(" "),t("p",[v._v("其中：")]),v._v(" "),t("ul",[t("li",[v._v("认证信息 A = fnv(片段部分），big endian；")]),v._v(" "),t("li",[v._v("片段部分可能包含多个片段；")])]),v._v(" "),t("h3",{attrs:{id:"数据片段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据片段"}},[v._v("#")]),v._v(" 数据片段")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("2 字节")]),v._v(" "),t("th",[v._v("1 字节")]),v._v(" "),t("th",[v._v("1 字节")]),v._v(" "),t("th",[v._v("4 字节")]),v._v(" "),t("th",[v._v("4 字节")]),v._v(" "),t("th",[v._v("4 字节")]),v._v(" "),t("th",[v._v("2 字节")]),v._v(" "),t("th",[v._v("Len 字节")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("标识 Conv")]),v._v(" "),t("td",[v._v("指令 Cmd")]),v._v(" "),t("td",[v._v("选项 Opt")]),v._v(" "),t("td",[v._v("时间戳 Ts")]),v._v(" "),t("td",[v._v("序列号 Sn")]),v._v(" "),t("td",[v._v("未确认序列号 Una")]),v._v(" "),t("td",[v._v("长度 Len")]),v._v(" "),t("td",[v._v("数据")])])])]),v._v(" "),t("p",[v._v("其中：")]),v._v(" "),t("ul",[t("li",[v._v("标识 Conv: mKCP 数据流的标识")]),v._v(" "),t("li",[v._v("指令 Cmd: 常量 0x01")]),v._v(" "),t("li",[v._v("选项 Opt: 可选的值有：\n"),t("ul",[t("li",[v._v("0x00: 空选项")]),v._v(" "),t("li",[v._v("0x01: 对方已发出所有数据")])])]),v._v(" "),t("li",[v._v("时间戳 Ts: 当前片段从远端发送出来时的时间，big endian")]),v._v(" "),t("li",[v._v("序列号 Sn: 该数据片段时数据流中的位置，起始片段的序列号为 0，之后每个新片段按顺序加 1")]),v._v(" "),t("li",[v._v("未确认序列号 Una: 远端主机正在发送的，且尚未收到确认的最小的 Sn")])]),v._v(" "),t("h3",{attrs:{id:"确认片段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#确认片段"}},[v._v("#")]),v._v(" 确认片段")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("2 字节")]),v._v(" "),t("th",[v._v("1 字节")]),v._v(" "),t("th",[v._v("1 字节")]),v._v(" "),t("th",[v._v("4 字节")]),v._v(" "),t("th",[v._v("4 字节")]),v._v(" "),t("th",[v._v("4 字节")]),v._v(" "),t("th",[v._v("2 字节")]),v._v(" "),t("th",[v._v("Len * 4 字节")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("标识 Conv")]),v._v(" "),t("td",[v._v("指令 Cmd")]),v._v(" "),t("td",[v._v("选项 Opt")]),v._v(" "),t("td",[v._v("窗口 Wnd")]),v._v(" "),t("td",[v._v("下一接收序列号 Sn")]),v._v(" "),t("td",[v._v("时间戳 Ts")]),v._v(" "),t("td",[v._v("长度 Len")]),v._v(" "),t("td",[v._v("已收到的序列号")])])])]),v._v(" "),t("p",[v._v("其中：")]),v._v(" "),t("ul",[t("li",[v._v("标识 Conv: mKCP 数据流的标识")]),v._v(" "),t("li",[v._v("指令 Cmd: 常量 0x00")]),v._v(" "),t("li",[v._v("选项 Opt: 同上")]),v._v(" "),t("li",[v._v("窗口 Wnd: 远端主机可以接收的最大序列号")]),v._v(" "),t("li",[v._v("下一接收序列号 Sn: 远端主机未收到的数据片段中的最小序列号")]),v._v(" "),t("li",[v._v("时间戳 Ts: 远端主机最新收到的数据片段的时间戳，可用于计算延迟")]),v._v(" "),t("li",[v._v("已收到的序列号: 每个 4 字节，表示此序列号的数据已经确认收到")])]),v._v(" "),t("p",[v._v("注释：")]),v._v(" "),t("ul",[t("li",[v._v("远程主机期待收到序列号 [Sn, Wnd) 范围内的数据")])]),v._v(" "),t("h3",{attrs:{id:"心跳片段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#心跳片段"}},[v._v("#")]),v._v(" 心跳片段")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("2 字节")]),v._v(" "),t("th",[v._v("1 字节")]),v._v(" "),t("th",[v._v("1 字节")]),v._v(" "),t("th",[v._v("4 字节")]),v._v(" "),t("th",[v._v("4 字节")]),v._v(" "),t("th",[v._v("4 字节")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("标识 Conv")]),v._v(" "),t("td",[v._v("指令 Cmd")]),v._v(" "),t("td",[v._v("选项 Opt")]),v._v(" "),t("td",[v._v("未确认序列号 Una")]),v._v(" "),t("td",[v._v("下一接收序列号 Sn")]),v._v(" "),t("td",[v._v("延迟 Rto")])])])]),v._v(" "),t("p",[v._v("其中：")]),v._v(" "),t("ul",[t("li",[v._v("标识 Conv: mKCP 数据流的标识")]),v._v(" "),t("li",[v._v("指令 Cmd: 可选的值有\n"),t("ul",[t("li",[v._v("0x02: 远端主机强行终止会话")]),v._v(" "),t("li",[v._v("0x03: 正常心跳")])])]),v._v(" "),t("li",[v._v("选项 Opt: 同上")]),v._v(" "),t("li",[v._v("未确认序列号 Una: 同数据片段的 Una")]),v._v(" "),t("li",[v._v("下一接收序列号 Sn: 同确认片段的 Sn")]),v._v(" "),t("li",[v._v("延迟 Rto: 远端主机自己计算出的延迟")])])])}),[],!1,null,null,null);_.default=r.exports}}]);